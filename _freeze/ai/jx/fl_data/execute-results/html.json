{
  "hash": "31ea3d1c9ef04f8a48151d05fdf31fda",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Loading datasets\naliases:\n  - fl_dataset.html\nauthor: Marie-HÃ©lÃ¨ne Burle\nbibliography: fl.bib\n---\n\n\n\n\n:::{.def}\n\nFlax does not implement methods to load datasets since [Hugging Face](https://github.com/huggingface/datasets), [PyTorch](https://github.com/pytorch/pytorch), and [TensorFlow](https://github.com/tensorflow/datasets) already provide great APIs for this.\n\n:::\n\n:::{.info}\n\nYou only need one of the methods below to load datasets, so you should only install one of the packages `datasets`, `torchvision`, or `tensorflow-datasets`. Trying to install them all will actually often result in conflicts between versions of some of their shared dependencies.\n\nFor this course, I installed `tensorflow-datasets` in our training cluster.\n\n:::\n\n## Hugging Face datasets\n\nThe [Datasets](https://github.com/huggingface/datasets) library from ðŸ¤— is a lightweight, framework-agnostic, and easy to use API to download datasets from the [Hugging Face Hub](https://huggingface.co/datasets). It uses [Apache Arrow](https://arrow.apache.org/)'s efficient caching system, allowing large datasets to be used on machines with small memory [@lhoest-etal-2021-datasets].\n\n### Search dataset\n\nGo to the [Hugging Face Hub](https://huggingface.co/datasets) and search through thousands of open source datasets provided by the community.\n\n### Inspect dataset\n\nYou can get information on a dataset before downloading it.\n\nLoad the dataset builder for the dataset you are interested in:\n\n::: {#d99e7f0b .cell execution_count=1}\n``` {.python .cell-code}\nfrom datasets import load_dataset_builder\nds_builder = load_dataset_builder(\"mnist\")\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg ansi-bold\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg ansi-bold\">ModuleNotFoundError</span>                       Traceback (most recent call last)\nCell <span class=\"ansi-green-fg ansi-bold\">In[1], line 1</span>\n<span class=\"ansi-green-fg ansi-bold\">----&gt; 1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">datasets</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> load_dataset_builder\n<span class=\"ansi-green-fg\">      2</span> ds_builder <span style=\"color:rgb(98,98,98)\">=</span> load_dataset_builder(<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">mnist</span><span style=\"color:rgb(175,0,0)\">\"</span>)\n\n<span class=\"ansi-red-fg ansi-bold\">ModuleNotFoundError</span>: No module named 'datasets'</pre>\n```\n:::\n\n:::\n:::\n\n\nGet a description of the dataset:\n\n::: {#65d30c01 .cell execution_count=2}\n``` {.python .cell-code}\nds_builder.info.description\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg ansi-bold\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg ansi-bold\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg ansi-bold\">In[2], line 1</span>\n<span class=\"ansi-green-fg ansi-bold\">----&gt; 1</span> <span class=\"ansi-red-bg\">ds_builder</span><span style=\"color:rgb(98,98,98)\">.</span>info<span style=\"color:rgb(98,98,98)\">.</span>description\n\n<span class=\"ansi-red-fg ansi-bold\">NameError</span>: name 'ds_builder' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\nGet information on the features:\n\n::: {#de8f87f1 .cell execution_count=3}\n``` {.python .cell-code}\nds_builder.info.features\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg ansi-bold\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg ansi-bold\">NameError</span>                                 Traceback (most recent call last)\nCell <span class=\"ansi-green-fg ansi-bold\">In[3], line 1</span>\n<span class=\"ansi-green-fg ansi-bold\">----&gt; 1</span> <span class=\"ansi-red-bg\">ds_builder</span><span style=\"color:rgb(98,98,98)\">.</span>info<span style=\"color:rgb(98,98,98)\">.</span>features\n\n<span class=\"ansi-red-fg ansi-bold\">NameError</span>: name 'ds_builder' is not defined</pre>\n```\n:::\n\n:::\n:::\n\n\n### Download dataset and load in session\n\n::: {#1828ff07 .cell execution_count=4}\n``` {.python .cell-code}\nfrom datasets import load_dataset\n\ndef get_dataset_hf():\n    mnist = load_dataset(\"mnist\")\n\n    ds = {}\n\n    for split in ['train', 'test']:\n        ds[split] = {\n            'image': np.array([np.array(im) for im in mnist[split]['image']]),\n            'label': np.array(mnist[split]['label'])\n        }\n\n        ds[split]['image'] = jnp.float32(ds[split]['image']) / 255\n        ds[split]['label'] = jnp.int16(ds[split]['label'])\n\n        ds[split]['image'] = jnp.expand_dims(ds[split]['image'], 3)\n\n    return ds['train'], ds['test']\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg ansi-bold\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg ansi-bold\">ModuleNotFoundError</span>                       Traceback (most recent call last)\nCell <span class=\"ansi-green-fg ansi-bold\">In[4], line 1</span>\n<span class=\"ansi-green-fg ansi-bold\">----&gt; 1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">from</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">datasets</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> load_dataset\n<span class=\"ansi-green-fg\">      3</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">def</span> <span style=\"color:rgb(0,0,255)\">get_dataset_hf</span>():\n<span class=\"ansi-green-fg\">      4</span>     mnist <span style=\"color:rgb(98,98,98)\">=</span> load_dataset(<span style=\"color:rgb(175,0,0)\">\"</span><span style=\"color:rgb(175,0,0)\">mnist</span><span style=\"color:rgb(175,0,0)\">\"</span>)\n\n<span class=\"ansi-red-fg ansi-bold\">ModuleNotFoundError</span>: No module named 'datasets'</pre>\n```\n:::\n\n:::\n:::\n\n\n## PyTorch Torchvision datasets\n\nTorchvision from PyTorch also provides an API to download and prepare [many standard datasets](https://pytorch.org/vision/stable/datasets.html) as well as utilities to build your own.\n\n```{.python}\nfrom torchvision import datasets\n\ndef get_dataset_torch():\n    mnist = {\n        'train': datasets.MNIST('./data', train=True, download=True),\n        'test': datasets.MNIST('./data', train=False, download=True)\n    }\n\n    ds = {}\n\n    for split in ['train', 'test']:\n        ds[split] = {\n            'image': mnist[split].data.numpy(),\n            'label': mnist[split].targets.numpy()\n        }\n\n        ds[split]['image'] = jnp.float32(ds[split]['image']) / 255\n        ds[split]['label'] = jnp.int16(ds[split]['label'])\n\n        ds[split]['image'] = jnp.expand_dims(ds[split]['image'], 3)\n\n    return ds['train'], ds['test']\n```\n\n## TensorFlow datasets\n\nTensorFlow also has [a dataset API](https://github.com/tensorflow/datasets) which can be installed as a standalone package.\n\n::: {#3d5cd961 .cell execution_count=5}\n``` {.python .cell-code}\nimport tensorflow_datasets as tfds\n\ndef get_dataset_tf(epochs, batch_size):\n    mnist = tfds.builder('mnist')\n    mnist.download_and_prepare()\n\n    ds = {}\n\n    for set in ['train', 'test']:\n        ds[set] = tfds.as_numpy(mnist.as_dataset(split=set, batch_size=-1))\n\n        # cast to jnp and rescale pixel values\n        ds[set]['image'] = jnp.float32(ds[set]['image']) / 255\n        ds[set]['label'] = jnp.int16(ds[set]['label'])\n\n    return ds['train'], ds['test']\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-red-fg ansi-bold\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-red-fg ansi-bold\">ModuleNotFoundError</span>                       Traceback (most recent call last)\nCell <span class=\"ansi-green-fg ansi-bold\">In[5], line 1</span>\n<span class=\"ansi-green-fg ansi-bold\">----&gt; 1</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">import</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">tensorflow_datasets</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">as</span> <span style=\"font-weight:bold;color:rgb(0,0,255)\">tfds</span>\n<span class=\"ansi-green-fg\">      3</span> <span style=\"font-weight:bold;color:rgb(0,135,0)\">def</span> <span style=\"color:rgb(0,0,255)\">get_dataset_tf</span>(epochs, batch_size):\n<span class=\"ansi-green-fg\">      4</span>     mnist <span style=\"color:rgb(98,98,98)\">=</span> tfds<span style=\"color:rgb(98,98,98)\">.</span>builder(<span style=\"color:rgb(175,0,0)\">'</span><span style=\"color:rgb(175,0,0)\">mnist</span><span style=\"color:rgb(175,0,0)\">'</span>)\n\n<span class=\"ansi-red-fg ansi-bold\">ModuleNotFoundError</span>: No module named 'tensorflow_datasets'</pre>\n```\n:::\n\n:::\n:::\n\n\n",
    "supporting": [
      "fl_data_files"
    ],
    "filters": [],
    "includes": {}
  }
}