{
  "hash": "a733720e10c4be8908b2060002ec72df",
  "result": {
    "markdown": "---\ntitle: Web scraping with R\nauthor: Marie-Hélène Burle\n---\n\n:::{.def}\n\nThe internet is a trove of information. A lot of it is publicly available and thus suitable for use in research. Extracting that information and putting it in an organized format for analysis can, however, be extremely tedious. Web scraping tools allow to automate parts of that process and R is a popular language for the task.\n\nIn this workshop, we will guide you through a simple example using the package [rvest](https://rvest.tidyverse.org/).\n\n:::\n\n<!-- 1. Scrape all the links of that page into a list -->\n<!-- 2. Use each link to extract the information \"Date of Award\", \"Degree Type\", etc. through a big loop -->\n\n## HTML and CSS\n\n\n\n## Web scrapping\n\n\n\n## Example\n\n### Goal\n\nWe will use [a website](https://trace.tennessee.edu/utk_graddiss/index.html) from the [University of Tennessee](https://www.utk.edu/) containing a database of PhD theses from that university.\n\nOur goal is to scrape data from this site to produce a dataframe with the date, major, and principal investigator (PI) for each dissertation.\n\n:::{.note}\n\nWe will only do this for the first page which contains the links for the 100 most recent theses. If you really wanted to gather all the data, you would have to do this for all pages.\n\n:::\n\n### Package\n\nWe will use the package [rvest](https://cran.r-project.org/web/packages/rvest/index.html), part of the [tidyverse](https://www.tidyverse.org/)—a modern set of R packages.\n\nLet's load it:\n\n```{.r}\nlibrary(rvest)\n```\n\n### Read in HTML data\n\nAs mentioned above, our site is the [database of PhD dissertations of the University of Tennessee](https://trace.tennessee.edu/utk_graddiss/index.html).\n\nLet's create a character vector with the url:\n\n```{.r}\nurl <- \"https://trace.tennessee.edu/utk_graddiss/index.html\"\n```\n\nFirst, we read in the html data from that page:\n\n```{.r}\nhtml <- read_html(url)\n```\n\nLet's have a look at the raw data:\n\n```{.r}\nhtml\n```\n\n```\n{html_document}\n<html lang=\"en\">\n[1] <head>\\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8 ...\n[2] <body>\\n<!-- FILE /srv/sequoia/main/data/trace.tennessee.edu/assets/heade ...\n```\n\n### Extracting relevant data\n\n#### Method\n\nTo find the relevant CSS element, you can use a web inspector or, even easier, the [SelectorGadget](https://selectorgadget.com/)—a JavaScript bookmarklet built by [Andrew Cantino](https://andrewcantino.com/).\n\n#### Extracting a single link\n\nFirst, let's try to extract a single link:\n\n```{.r}\ntest <- html %>% html_element(\".article-listing\")\ntest\n```\n\n```\n{html_node}\n<p class=\"article-listing\">\n[1] <a href=\"https://trace.tennessee.edu/utk_graddiss/7600\">The Novel Chlorin ...\n```\n\nThe link is in there, but we need to do more extracting.\n\n```{.r}\nstr(test)\n```\n\n```\nList of 2\n $ node:<externalptr> \n $ doc :<externalptr> \n - attr(*, \"class\")= chr \"xml_node\"\n```\n\n```{.r}\na_test <- test %>% html_elements(\"a\")\na_test\n```\n\nMuch better, but we now need to extract the `href` attribute:\n\n```\n{xml_nodeset (1)}\n[1] <a href=\"https://trace.tennessee.edu/utk_graddiss/7600\">The Novel Chlorin ...\n```\n\n```{.r}\na_test %>% html_attrs()\n```\n\n```\n[[1]]\n                                           href \n\"https://trace.tennessee.edu/utk_graddiss/7600\" \n```\n\n```{.r}\nlink_test <- a_test %>% html_attr(\"href\")\nlink_test\n```\n\n```\n[1] \"https://trace.tennessee.edu/utk_graddiss/7600\"\n```\n\n```{.r}\nstr(link_test)\n```\n\n```\nchr \"https://trace.tennessee.edu/utk_graddiss/7600\"\n```\n\n#### Getting data from our test link\n\n```{.r}\nhtml_test <- read_html(link_test)\nhtml_test\n```\n\n```\n<html lang=\"en\">\n[1] <head>\\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8 ...\n[2] <body>\\n<!-- FILE /srv/sequoia/main/data/trace.tennessee.edu/assets/heade ...\n```\n\n```{.r}\ndate <- html_test %>% html_elements(\"#publication_date p\") %>% html_text2()\ndate\n```\n\n```\n[1] \"5-2023\"\n```\n\n```{.r}\nmajor <- html_test %>% html_elements(\"#department p\") %>% html_text2()\nmajor\n```\n\n```\n[1] \"Chemistry\"\n```\n\n```{.r}\npi <- html_test %>% html_elements(\"#advisor1 p\") %>% html_text2()\npi\n```\n\n```\n[1] \"Craig E. Barnes\"\n```\n\n```{.r}\ncbind(date, major, pi)\n```\n\n```\n     date     major       pi               \n[1,] \"5-2023\" \"Chemistry\" \"Craig E. Barnes\"\n```\n\n#### Extracting all links\n\n```{.r}\ndat <- html %>% html_elements(\".article-listing\")\ndat\n```\n\n```\n{xml_nodeset (100)}\n [1] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n [2] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n [3] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n [4] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n [5] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n [6] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n [7] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n [8] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n [9] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n[10] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n[11] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n[12] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n[13] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n[14] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n[15] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n[16] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n[17] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n[18] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n[19] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n[20] <p class=\"article-listing\"><a href=\"https://trace.tennessee.edu/utk_grad ...\n...\n```\n\n```{.r}\nstr(dat)\n```\n\n```\nList of 100\n $ :List of 2\n  ..$ node:<externalptr> \n  ..$ doc :<externalptr> \n  ..- attr(*, \"class\")= chr \"xml_node\"\n $ :List of 2\n  ..$ node:<externalptr> \n  ..$ doc :<externalptr> \n  ..- attr(*, \"class\")= chr \"xml_node\"\n $ :List of 2\n  ..$ node:<externalptr> \n  ..$ doc :<externalptr> \n  ..- attr(*, \"class\")= chr \"xml_node\"\n $ :List of 2\n  ..$ node:<externalptr> \n  ..$ doc :<externalptr> \n  ..- attr(*, \"class\")= chr \"xml_node\"\n...\n```\n\nInitialize an empty list:\n\n```{.r}\nlist_links <- vector(\"list\", length(dat))\nlist_links[[2]]\n```\n\n```\nNULL\n```\n\n```{.r}\nfor (i in seq_along(dat)) {\n  list_links[[i]] <- dat[[i]] %>%\n    html_elements(\"a\") %>%\n    html_attr(\"href\")\n}\nlist_links[[2]]\n```\n\n```\n[1] \"https://trace.tennessee.edu/utk_graddiss/7714\"\n```\n\n#### Getting the data from the list of links\n\nInitialize empty lists:\n\n```{.r}\nlist_data <- vector(\"list\", length(list_links))\nhtml <- vector(\"list\", length(list_links))\n```\n\n```{.r}\nfor (i in seq_along(list_links)) {\n  html[[i]] <- read_html(list_links[[i]])\n  date <- html[[i]] %>%\n    html_elements(\"#publication_date p\") %>%\n    html_text2()\n  major <- html[[i]] %>%\n    html_elements(\"#department p\") %>%\n    html_text2()\n  pi <- html[[i]] %>%\n    html_elements(\"#advisor1 p\") %>%\n    html_text2()\n  list_data[[i]] <- cbind(date, major, pi)\n}\nlist_data[[2]]\n```\n\n```{.r}\nresult <- do.call(rbind.data.frame, list_data) %>%\n  tibble::as_tibble()\n```\n\n```{.r}\nresult\n```\n\n```\n# A tibble: 100 × 3\n   date    major                                      pi                   \n   <chr>   <chr>                                      <chr>                \n 1 5-2023  Chemistry                                  Craig E. Barnes      \n 2 12-2022 Chemistry                                  Dr. Ampofo K. Darko  \n 3 12-2022 Industrial Engineering                     James Ostrowski      \n 4 5-2022  Entomology, Plant Pathology and Nematology Heather Kelly        \n 5 5-2022  Mechanical Engineering                     Caleb D. Rucker      \n 6 12-2022 Electrical Engineering                     Yilu Liu             \n 7 5-2022  Comparative and Experimental Medicine      Brian K. Whitlock    \n 8 5-2022  History                                    Jay Rubenstein       \n 9 12-2022 Anthropology                               Dawnie W. Steadman   \n10 12-2022 Mechanical Engineering                     Stephanie C. TerMaath\n# … with 90 more rows\n# ℹ Use `print(n = ...)` to see more rows\n```\n\n```{.r}\nnames(result) <- c(\"Date\", \"Major\", \"PI\")\n```\n\n```{.r}\nresult\n```\n\n```\n# A tibble: 100 × 3\n   Date    Major                                      PI                   \n   <chr>   <chr>                                      <chr>                \n 1 5-2023  Chemistry                                  Craig E. Barnes      \n 2 12-2022 Chemistry                                  Dr. Ampofo K. Darko  \n 3 12-2022 Industrial Engineering                     James Ostrowski      \n 4 5-2022  Entomology, Plant Pathology and Nematology Heather Kelly        \n 5 5-2022  Mechanical Engineering                     Caleb D. Rucker      \n 6 12-2022 Electrical Engineering                     Yilu Liu             \n 7 5-2022  Comparative and Experimental Medicine      Brian K. Whitlock    \n 8 5-2022  History                                    Jay Rubenstein       \n 9 12-2022 Anthropology                               Dawnie W. Steadman   \n10 12-2022 Mechanical Engineering                     Stephanie C. TerMaath\n# … with 90 more rows\n# ℹ Use `print(n = ...)` to see more rows\n```\n\n",
    "supporting": [
      "webscraping_files"
    ],
    "filters": [],
    "includes": {}
  }
}