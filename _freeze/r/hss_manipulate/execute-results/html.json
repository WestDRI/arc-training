{
  "hash": "2b14d9791ecb96edc7bbd27fc3266914",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Data wrangling\nauthor: Marie-Hélène Burle\n---\n\n\n:::{.def}\n\nOnce we know what is in our data, we can start playing with it. Let's manipulate the `us_contagious_diseases` dataset from the [dslabs package](https://cran.r-project.org/web/packages/dslabs/index.html).\n\n:::\n\n## Load packages\n\nOne of the tidyverse packages is very useful for data manipulation: [dplyr](https://dplyr.tidyverse.org/). Let's load the `dslabs` package again as well as `dplyr`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dslabs)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n:::\n\n\n## Indexing\n\nYou can extract a subset of the data using their position by indexing. Indexing in R starts with `1` (in many languages, the first index is `0`) and it is done with square brackets. Since a data frame has two dimensions, there are two possible indices in the square brackets:\n\n- the row index,\n- the column index.\n\nYou can index a single element:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_contagious_diseases[1, 1]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] Hepatitis A\nLevels: Hepatitis A Measles Mumps Pertussis Polio Rubella Smallpox\n```\n\n\n:::\n\n```{.r .cell-code}\nus_contagious_diseases[1, 2]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] Alabama\n51 Levels: Alabama Alaska Arizona Arkansas California Colorado ... Wyoming\n```\n\n\n:::\n:::\n\n\nOr a full row:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_contagious_diseases[1, ]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      disease   state year weeks_reporting count population\n1 Hepatitis A Alabama 1966              50   321    3345787\n```\n\n\n:::\n\n```{.r .cell-code}\nus_contagious_diseases[3000, ]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     disease                state year weeks_reporting count population\n3000 Measles District Of Columbia 1981              27     2     631010\n```\n\n\n:::\n:::\n\n\n:::{.exo}\n\n:::{.yourturn}\n\nYour turn:\n\n:::\n\nHow would you index the year column?\n\n:::\n\n## Filtering rows\n\nYou can also filter data points based on their values:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_contagious_diseases |>\n  filter(state == \"California\") |>\n  count()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    n\n1 315\n```\n\n\n:::\n:::\n\n\n:::{.exo}\n\n:::{.yourturn}\n\nYour turn:\n\n:::\n\nHow many data points are there for the state of Arizona?\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_contagious_diseases |>\n  filter(state == \"California\" & year > 2000)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       disease      state year weeks_reporting count population\n1  Hepatitis A California 2001              40  1599   34199784\n2  Hepatitis A California 2002              49  1364   34529758\n3  Hepatitis A California 2003              46  1045   34861711\n4  Hepatitis A California 2004              48   788   35195792\n5  Hepatitis A California 2005              49   905   35532154\n6  Hepatitis A California 2006              52   688   35870957\n7  Hepatitis A California 2007              51   312   36212364\n8  Hepatitis A California 2008              52   337   36556548\n9  Hepatitis A California 2009              52   239   36903684\n10 Hepatitis A California 2010              49   201   37253956\n11 Hepatitis A California 2011              49   176   37607525\n12     Measles California 2001              40    34   34199784\n13     Measles California 2002              33     0   34529758\n14       Mumps California 2001              49    37   34199784\n15       Mumps California 2002              49    66   34529758\n16   Pertussis California 2001              40   440   34199784\n17   Pertussis California 2002              43   698   34529758\n18   Pertussis California 2003              41   635   34861711\n19   Pertussis California 2004              36   498   35195792\n20   Pertussis California 2005              45  1609   35532154\n21   Pertussis California 2006              42   831   35870957\n22   Pertussis California 2007              29    95   36212364\n23   Pertussis California 2008              39   276   36556548\n24   Pertussis California 2009              40   415   36903684\n25   Pertussis California 2010              48  1265   37253956\n26   Pertussis California 2011              49  1145   37607525\n27     Rubella California 2001               1     0   34199784\n28     Rubella California 2002              29     2   34529758\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nus_contagious_diseases |>\n  filter(state == \"California\" & year > 2000) |>\n  arrange(year)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       disease      state year weeks_reporting count population\n1  Hepatitis A California 2001              40  1599   34199784\n2      Measles California 2001              40    34   34199784\n3        Mumps California 2001              49    37   34199784\n4    Pertussis California 2001              40   440   34199784\n5      Rubella California 2001               1     0   34199784\n6  Hepatitis A California 2002              49  1364   34529758\n7      Measles California 2002              33     0   34529758\n8        Mumps California 2002              49    66   34529758\n9    Pertussis California 2002              43   698   34529758\n10     Rubella California 2002              29     2   34529758\n11 Hepatitis A California 2003              46  1045   34861711\n12   Pertussis California 2003              41   635   34861711\n13 Hepatitis A California 2004              48   788   35195792\n14   Pertussis California 2004              36   498   35195792\n15 Hepatitis A California 2005              49   905   35532154\n16   Pertussis California 2005              45  1609   35532154\n17 Hepatitis A California 2006              52   688   35870957\n18   Pertussis California 2006              42   831   35870957\n19 Hepatitis A California 2007              51   312   36212364\n20   Pertussis California 2007              29    95   36212364\n21 Hepatitis A California 2008              52   337   36556548\n22   Pertussis California 2008              39   276   36556548\n23 Hepatitis A California 2009              52   239   36903684\n24   Pertussis California 2009              40   415   36903684\n25 Hepatitis A California 2010              49   201   37253956\n26   Pertussis California 2010              48  1265   37253956\n27 Hepatitis A California 2011              49   176   37607525\n28   Pertussis California 2011              49  1145   37607525\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nus_contagious_diseases |>\n  filter(state == \"California\" & year > 2000) |>\n  arrange(count)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       disease      state year weeks_reporting count population\n1      Measles California 2002              33     0   34529758\n2      Rubella California 2001               1     0   34199784\n3      Rubella California 2002              29     2   34529758\n4      Measles California 2001              40    34   34199784\n5        Mumps California 2001              49    37   34199784\n6        Mumps California 2002              49    66   34529758\n7    Pertussis California 2007              29    95   36212364\n8  Hepatitis A California 2011              49   176   37607525\n9  Hepatitis A California 2010              49   201   37253956\n10 Hepatitis A California 2009              52   239   36903684\n11   Pertussis California 2008              39   276   36556548\n12 Hepatitis A California 2007              51   312   36212364\n13 Hepatitis A California 2008              52   337   36556548\n14   Pertussis California 2009              40   415   36903684\n15   Pertussis California 2001              40   440   34199784\n16   Pertussis California 2004              36   498   35195792\n17   Pertussis California 2003              41   635   34861711\n18 Hepatitis A California 2006              52   688   35870957\n19   Pertussis California 2002              43   698   34529758\n20 Hepatitis A California 2004              48   788   35195792\n21   Pertussis California 2006              42   831   35870957\n22 Hepatitis A California 2005              49   905   35532154\n23 Hepatitis A California 2003              46  1045   34861711\n24   Pertussis California 2011              49  1145   37607525\n25   Pertussis California 2010              48  1265   37253956\n26 Hepatitis A California 2002              49  1364   34529758\n27 Hepatitis A California 2001              40  1599   34199784\n28   Pertussis California 2005              45  1609   35532154\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nus_contagious_diseases |>\n  filter(state == \"California\" & year > 2000) |>\n  arrange(desc(count))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       disease      state year weeks_reporting count population\n1    Pertussis California 2005              45  1609   35532154\n2  Hepatitis A California 2001              40  1599   34199784\n3  Hepatitis A California 2002              49  1364   34529758\n4    Pertussis California 2010              48  1265   37253956\n5    Pertussis California 2011              49  1145   37607525\n6  Hepatitis A California 2003              46  1045   34861711\n7  Hepatitis A California 2005              49   905   35532154\n8    Pertussis California 2006              42   831   35870957\n9  Hepatitis A California 2004              48   788   35195792\n10   Pertussis California 2002              43   698   34529758\n11 Hepatitis A California 2006              52   688   35870957\n12   Pertussis California 2003              41   635   34861711\n13   Pertussis California 2004              36   498   35195792\n14   Pertussis California 2001              40   440   34199784\n15   Pertussis California 2009              40   415   36903684\n16 Hepatitis A California 2008              52   337   36556548\n17 Hepatitis A California 2007              51   312   36212364\n18   Pertussis California 2008              39   276   36556548\n19 Hepatitis A California 2009              52   239   36903684\n20 Hepatitis A California 2010              49   201   37253956\n21 Hepatitis A California 2011              49   176   37607525\n22   Pertussis California 2007              29    95   36212364\n23       Mumps California 2002              49    66   34529758\n24       Mumps California 2001              49    37   34199784\n25     Measles California 2001              40    34   34199784\n26     Rubella California 2002              29     2   34529758\n27     Measles California 2002              33     0   34529758\n28     Rubella California 2001               1     0   34199784\n```\n\n\n:::\n:::\n\n\n## Selecting columns\n\nWe saw how to index columns from their position. It is also possible to select them based on their names:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(us_contagious_diseases$year, 50)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 1966 1967 1968 1969 1970 1971 1972 1973 1974 1975 1976 1977 1978 1979 1980\n[16] 1981 1982 1983 1984 1985 1986 1987 1988 1989 1990 1991 1992 1993 1994 1995\n[31] 1996 1997 1998 1999 2000 2001 2002 2003 2004 2005 2006 2007 2008 2009 2010\n[46] 2011 1966 1967 1968 1969\n```\n\n\n:::\n:::\n\n\nIf you want to select several columns, you can use the `select()` function from `dplyr`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_contagious_diseases |>\n  filter(state == \"California\" & year > 2000 & disease == \"Hepatitis A\") |>\n  select(year, count, population)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   year count population\n1  2001  1599   34199784\n2  2002  1364   34529758\n3  2003  1045   34861711\n4  2004   788   35195792\n5  2005   905   35532154\n6  2006   688   35870957\n7  2007   312   36212364\n8  2008   337   36556548\n9  2009   239   36903684\n10 2010   201   37253956\n11 2011   176   37607525\n```\n\n\n:::\n:::\n\n\n## Grouping data\n\nIt is often useful to group data by categories to compute some summary statistics.\n\nFor instance, we can group by year and calculate the total numbers of infections:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_contagious_diseases |>\n  group_by(year) |>\n  summarise(total = sum(count))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 84 × 2\n    year  total\n   <dbl>  <dbl>\n 1  1928 524563\n 2  1929 380196\n 3  1930 439289\n 4  1931 482886\n 5  1932 404683\n 6  1933 391485\n 7  1934 739509\n 8  1935 739224\n 9  1936 292530\n10  1937 314425\n# ℹ 74 more rows\n```\n\n\n:::\n:::\n\n\nAlternatively, we can group by state and get the totals:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_contagious_diseases |>\n  group_by(state) |> \n  summarise(total = sum(count))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 51 × 2\n   state                  total\n   <fct>                  <dbl>\n 1 Alabama               257979\n 2 Alaska                 29136\n 3 Arizona               240233\n 4 Arkansas              177556\n 5 California           1906067\n 6 Colorado              322845\n 7 Connecticut           463148\n 8 Delaware               44427\n 9 District Of Columbia   77012\n10 Florida               268383\n# ℹ 41 more rows\n```\n\n\n:::\n:::\n\n\nWe can also group by year and state and get the totals:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_contagious_diseases |>\n  group_by(year, state) |> \n  summarise(total = sum(count))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'year'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4,284 × 3\n# Groups:   year [84]\n    year state                total\n   <dbl> <fct>                <dbl>\n 1  1928 Alabama               9246\n 2  1928 Alaska                   0\n 3  1928 Arizona               1268\n 4  1928 Arkansas              9157\n 5  1928 California            4960\n 6  1928 Colorado              2510\n 7  1928 Connecticut          10247\n 8  1928 Delaware               607\n 9  1928 District Of Columbia  2609\n10  1928 Florida               1892\n# ℹ 4,274 more rows\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}