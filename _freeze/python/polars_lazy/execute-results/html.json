{
  "hash": "fb51aefbc5a5073321e1c49bc3f2c3d3",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: Lazy evaluation\nauthor: Marie-Hélène Burle\n---\n\n:::{.def}\n\nWhen it comes to high-performance computing, one of the strengths of Polars is that it supports [lazy evaluation](https://en.wikipedia.org/wiki/Lazy_evaluation). Lazy evaluation instantly returns a future that can be used without waiting for the result of the computation. Moreover, when you run queries on a LazyFrame, Polars creates a graph and runs [optimizations](https://docs.pola.rs/user-guide/lazy/optimizations/) on it, very much the way compiled languages work.\n\nIf you want to speedup your code, **use lazy execution whenever possible.**\n\n:::\n\n## Reading in data to a LazyFrame\n\nIdeally, you want to use the lazy API from the start, when you read in the data.\n\nIn the previous examples, we used [`polars.read_csv`](https://docs.pola.rs/api/python/stable/reference/api/polars.read_csv.html#polars.read_csv) to read our data. This returns a Polars DataFrame:\n\n::: {#edfd0b60 .cell execution_count=2}\n``` {.python .cell-code}\nimport polars as pl\n\nurl = \"https://cdn.jsdelivr.net/npm/vega-datasets/data/disasters.csv\"\n\ndf = pl.read_csv(url)\ntype(df)\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```\npolars.dataframe.frame.DataFrame\n```\n:::\n:::\n\n\nInstead, you can use [`polars.scan_csv`](https://docs.pola.rs/api/python/stable/reference/api/polars.scan_csv.html#polars.scan_csv) to create a LazyFrame:\n\n::: {#ff3e4f63 .cell execution_count=3}\n``` {.python .cell-code}\ndf_lazy = pl.scan_csv(url)\ntype(df_lazy)\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```\npolars.lazyframe.frame.LazyFrame\n```\n:::\n:::\n\n\n:::{.note}\n\nThere are scan functions [for all the IO methods Polars offers](https://docs.pola.rs/user-guide/io/).\n\n:::\n\n## Converting to a LazyFrame\n\nIf you already have a DataFrame, you can create a LazyFrame from it with the [`polars.DataFrame.lazy`](https://docs.pola.rs/api/python/stable/reference/dataframe/api/polars.DataFrame.lazy.html#polars.DataFrame.lazy) method:\n\n::: {#eb4ba989 .cell execution_count=4}\n``` {.python .cell-code}\ndf_lazy = df.lazy()\n```\n:::\n\n\n## Getting the results\n\nTo get results from a LazyFrame, you use [`polars.LazyFrame.collect`](https://docs.pola.rs/api/python/stable/reference/lazyframe/api/polars.LazyFrame.collect.html).\n\nThis won't work because a LazyFrame has no attribute `shape`:\n\n::: {#10aab8f7 .cell execution_count=5}\n``` {.python .cell-code}\ndf_lazy.filter(pl.col(\"Year\") == 2001).shape\n```\n\n::: {.cell-output .cell-output-error}\n\n::: {.ansi-escaped-output}\n```{=html}\n<pre><span class=\"ansi-bright-red-fg\">---------------------------------------------------------------------------</span>\n<span class=\"ansi-bright-red-fg\">AttributeError</span>                            Traceback (most recent call last)\n<span class=\"ansi-bright-cyan-fg\">Cell</span><span class=\"ansi-bright-cyan-fg\"> </span><span class=\"ansi-green-fg\">In[17]</span><span class=\"ansi-green-fg\">, line 1</span>\n<span class=\"ansi-bright-green-fg\">----&gt; </span><span class=\"ansi-bright-green-fg\">1</span> <span class=\"ansi-bright-white-fg ansi-yellow-bg\">df_lazy</span><span style=\"color:rgb(255,95,135)\" class=\"ansi-yellow-bg\">.</span><span class=\"ansi-bright-white-fg ansi-yellow-bg\">filter</span><span class=\"ansi-bright-white-fg ansi-yellow-bg\">(</span><span class=\"ansi-bright-white-fg ansi-yellow-bg\">pl</span><span style=\"color:rgb(255,95,135)\" class=\"ansi-yellow-bg\">.</span><span class=\"ansi-bright-white-fg ansi-yellow-bg\">col</span><span class=\"ansi-bright-white-fg ansi-yellow-bg\">(</span><span style=\"color:rgb(215,215,135)\" class=\"ansi-yellow-bg\">\"</span><span style=\"color:rgb(215,215,135)\" class=\"ansi-yellow-bg\">Year</span><span style=\"color:rgb(215,215,135)\" class=\"ansi-yellow-bg\">\"</span><span class=\"ansi-bright-white-fg ansi-yellow-bg\">)</span><span class=\"ansi-bright-white-fg ansi-yellow-bg\"> </span><span style=\"color:rgb(255,95,135)\" class=\"ansi-yellow-bg\">==</span><span class=\"ansi-bright-white-fg ansi-yellow-bg\"> </span><span style=\"color:rgb(175,135,255)\" class=\"ansi-yellow-bg\">2001</span><span class=\"ansi-bright-white-fg ansi-yellow-bg\">)</span><span style=\"color:rgb(255,95,135)\" class=\"ansi-yellow-bg\">.</span><span class=\"ansi-bright-white-fg ansi-yellow-bg\">shape</span>\n\n<span class=\"ansi-bright-red-fg\">AttributeError</span>: 'LazyFrame' object has no attribute 'shape'</pre>\n```\n:::\n\n:::\n:::\n\n\nYou need to `collect` the result first:\n\n::: {#f3b47443 .cell execution_count=6}\n``` {.python .cell-code}\ndf_lazy.filter(pl.col(\"Year\") == 2001).collect().shape\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```\n(9, 3)\n```\n:::\n:::\n\n\n`collect` turns your LazyFrame into a DataFrame, but it only does so on the subset needed for your query:\n\n::: {#857d3598 .cell execution_count=7}\n``` {.python .cell-code}\ntype(df_lazy.filter(pl.col(\"Year\") == 2001).collect())\n```\n\n::: {.cell-output .cell-output-display execution_count=19}\n```\npolars.dataframe.frame.DataFrame\n```\n:::\n:::\n\n\nThis allows you to work with data too big to fit in memory!\n\n",
    "supporting": [
      "polars_lazy_files"
    ],
    "filters": [],
    "includes": {}
  }
}