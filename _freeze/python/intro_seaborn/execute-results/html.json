{
  "hash": "c3f5081ddac5dc0fc3e123432bf7c946",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"seaborn: a brief introduction\"\nauthor: Marie-Hélène Burle\nbibliography: python.bib\ncsl: ../diabetologia.csl\n---\n\n:::{.def}\n\n[seaborn](https://seaborn.pydata.org/), at its core, is a statistical visualization library for tabular data[@Waskom2021]. It is based on [matplotlib](https://matplotlib.org/), but its higher-level, declarative, and easy interface makes it ideal for [exploratory data analysis (EDA)](https://en.wikipedia.org/wiki/Exploratory_data_analysis). It comes with demo datasets and statistical tools.\n\n:::\n\n## Getting data\n\n[seaborn](https://seaborn.pydata.org/) comes with a number of [datasets](https://github.com/mwaskom/seaborn-data) used in its documentation. They are convenient to play with the library. In this section however, we use [snow survey data for the province of British Columbia (Canada)](https://www2.gov.bc.ca/gov/content/environment/air-land-water/water/water-science-data/water-data-tools/snow-survey-data).\n\nThe data is tabular and stored in a CSV file. We read it into a Polars DataFrame:\n\n\n\n```{.python}\nimport polars as pl\n\nfile_path = \"/project/def-sponsor00/data/allmss_archive.csv\"\n```\n\n### Troubleshooting data reading\n\n[As we saw earlier](intro_df.qmd), you read tabular data in a Polars DataFrame with:\n\n```{.python}\ndf = pl.read_csv(file_path)\n```\n\nHowever, here, we get the following error:\n\n```\nComputeError: could not parse `35.0` as dtype `i64` at column ' Snow Depth cm' (column number 5)\n```\n\nWith, conveniently, the following suggestions:\n\n```\nYou might want to try:\n- increasing `infer_schema_length` (e.g. `infer_schema_length=10000`),\n- specifying correct dtype with the `schema_overrides` argument\n- setting `ignore_errors` to `True`,\n- adding `35.0` to the `null_values` list.n\n```\n\nIf you want to be sure to read the data without error, you can use `ignore_errors=True`, but this will drop the problematic rows and you will loose data. This is the solution of last resort.\n\nA better solution here is to set the [schema](https://docs.pola.rs/user-guide/lazy/schemas/) for the problematic variable manually:\n\n```{.python}\ndf = pl.read_csv(file_path, schema_overrides={\" Snow Depth cm\": pl.Float64})\n```\n\nBut oops. We now get the following error:\n\n```\nComputeError: could not parse `760.0` as dtype `i64` at column ' Water Equiv. mm' (column number 6)\n```\n\n:::{.exo}\n\n:::{.yourturn}\n\nYour turn:\n\n:::\n\nFix the new problem to read in the data.\n\n\n\n:::\n\n## Data exploration and transformation\n\nHere is our DataFrame:\n\n::: {#d4fd2b7b .cell execution_count=3}\n``` {.python .cell-code}\nprint(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (60_265, 10)\n┌──────────────┬─────────┬────────┬─────────────┬───┬─────────┬─────────────┬─────────────┬────────┐\n│ Snow Course  ┆  Number ┆ Elev.  ┆ Date of     ┆ … ┆ Survey  ┆ Snow Line   ┆  Density %  ┆ Survey │\n│ Name         ┆ ---     ┆ metres ┆ Survey      ┆   ┆ Code    ┆ Elev. m     ┆ ---         ┆ Period │\n│ ---          ┆ str     ┆ ---    ┆ ---         ┆   ┆ ---     ┆ ---         ┆ i64         ┆ ---    │\n│ str          ┆         ┆ i64    ┆ str         ┆   ┆ str     ┆ str         ┆             ┆ str    │\n╞══════════════╪═════════╪════════╪═════════════╪═══╪═════════╪═════════════╪═════════════╪════════╡\n│ YELLOWHEAD   ┆ 1A01    ┆ 1860   ┆ 1951/03/30  ┆ … ┆ null    ┆ null        ┆ 31          ┆ 01-Apr │\n│ YELLOWHEAD   ┆ 1A01    ┆ 1860   ┆ 1951/04/30  ┆ … ┆ null    ┆ null        ┆ 33          ┆ 01-May │\n│ YELLOWHEAD   ┆ 1A01    ┆ 1860   ┆ 1951/05/19  ┆ … ┆ null    ┆ null        ┆ 36          ┆ 15-May │\n│ YELLOWHEAD   ┆ 1A01    ┆ 1860   ┆ 1952/04/30  ┆ … ┆ null    ┆ null        ┆ 33          ┆ 01-May │\n│ YELLOWHEAD   ┆ 1A01    ┆ 1860   ┆ 1952/05/19  ┆ … ┆ null    ┆ null        ┆ 33          ┆ 15-May │\n│ …            ┆ …       ┆ …      ┆ …           ┆ … ┆ …       ┆ …           ┆ …           ┆ …      │\n│ STANLEY      ┆ 4E03    ┆ 930    ┆ 1985/05/16  ┆ … ┆ null    ┆ null        ┆ 37          ┆ 15-May │\n│ CREEK        ┆         ┆        ┆             ┆   ┆         ┆             ┆             ┆        │\n│ STANLEY      ┆ 4E03    ┆ 930    ┆ 1986/03/02  ┆ … ┆ null    ┆ null        ┆ 23          ┆ 01-Mar │\n│ CREEK        ┆         ┆        ┆             ┆   ┆         ┆             ┆             ┆        │\n│ STANLEY      ┆ 4E03    ┆ 930    ┆ 1986/04/01  ┆ … ┆ PROBLEM ┆ null        ┆ 27          ┆ 01-Apr │\n│ CREEK        ┆         ┆        ┆             ┆   ┆         ┆             ┆             ┆        │\n│ STANLEY      ┆ 4E03    ┆ 930    ┆ 1986/05/01  ┆ … ┆ PROBLEM ┆ null        ┆ 33          ┆ 01-May │\n│ CREEK        ┆         ┆        ┆             ┆   ┆         ┆             ┆             ┆        │\n│ STANLEY      ┆ 4E03    ┆ 930    ┆ 1986/05/15  ┆ … ┆ null    ┆ null        ┆ 34          ┆ 15-May │\n│ CREEK        ┆         ┆        ┆             ┆   ┆         ┆             ┆             ┆        │\n└──────────────┴─────────┴────────┴─────────────┴───┴─────────┴─────────────┴─────────────┴────────┘\n```\n:::\n:::\n\n\n### First cleaning\n\nLet's create a cleaned DataFrame with relevant columns, the date into a proper format, etc.:\n\n::: {#35a60639 .cell execution_count=4}\n``` {.python .cell-code}\nsnow_data = df.select(\n\tpl.col(\"Snow Course Name\").str.to_titlecase().alias(\"station\"),\n\tpl.col(\" Elev. metres\").alias(\"elevation\"),\n\tpl.col(\" Date of Survey\").str.to_date(\"%Y/%m/%d\").alias(\"date\"),\n\tpl.col(\" Snow Depth cm\").alias(\"snow\"),\n\tpl.col(\" Water Equiv. mm\").alias(\"water\")\n)\n\nprint(snow_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (60_265, 5)\n┌───────────────┬───────────┬────────────┬───────┬───────┐\n│ station       ┆ elevation ┆ date       ┆ snow  ┆ water │\n│ ---           ┆ ---       ┆ ---        ┆ ---   ┆ ---   │\n│ str           ┆ i64       ┆ date       ┆ f64   ┆ f64   │\n╞═══════════════╪═══════════╪════════════╪═══════╪═══════╡\n│ Yellowhead    ┆ 1860      ┆ 1951-03-30 ┆ 168.0 ┆ 528.0 │\n│ Yellowhead    ┆ 1860      ┆ 1951-04-30 ┆ 147.0 ┆ 485.0 │\n│ Yellowhead    ┆ 1860      ┆ 1951-05-19 ┆ 89.0  ┆ 320.0 │\n│ Yellowhead    ┆ 1860      ┆ 1952-04-30 ┆ 157.0 ┆ 523.0 │\n│ Yellowhead    ┆ 1860      ┆ 1952-05-19 ┆ 79.0  ┆ 264.0 │\n│ …             ┆ …         ┆ …          ┆ …     ┆ …     │\n│ Stanley Creek ┆ 930       ┆ 1985-05-16 ┆ 83.0  ┆ 307.0 │\n│ Stanley Creek ┆ 930       ┆ 1986-03-02 ┆ 142.0 ┆ 320.0 │\n│ Stanley Creek ┆ 930       ┆ 1986-04-01 ┆ 135.0 ┆ 365.0 │\n│ Stanley Creek ┆ 930       ┆ 1986-05-01 ┆ 121.0 ┆ 400.0 │\n│ Stanley Creek ┆ 930       ┆ 1986-05-15 ┆ 83.0  ┆ 285.0 │\n└───────────────┴───────────┴────────────┴───────┴───────┘\n```\n:::\n:::\n\n\nWe can explore the data a bit:\n\n::: {#e5b4c114 .cell execution_count=5}\n``` {.python .cell-code}\nprint(snow_data.columns)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n['station', 'elevation', 'date', 'snow', 'water']\n```\n:::\n:::\n\n\n::: {#caaeaabf .cell execution_count=6}\n``` {.python .cell-code}\nsnow_data.glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 60265\nColumns: 5\n$ station    <str> 'Yellowhead', 'Yellowhead', 'Yellowhead', 'Yellowhead', 'Yellowhead', 'Yellowhead', 'Yellowhead', 'Yellowhead', 'Yellowhead', 'Yellowhead'\n$ elevation  <i64> 1860, 1860, 1860, 1860, 1860, 1860, 1860, 1860, 1860, 1860\n$ date      <date> 1951-03-30, 1951-04-30, 1951-05-19, 1952-04-30, 1952-05-19, 1953-04-01, 1953-05-01, 1953-05-15, 1954-04-05, 1954-04-29\n$ snow       <f64> 168.0, 147.0, 89.0, 157.0, 79.0, 140.0, 130.0, 91.0, 193.0, 198.0\n$ water      <f64> 528.0, 485.0, 320.0, 523.0, 264.0, 404.0, 455.0, 297.0, 564.0, 577.0\n\n```\n:::\n:::\n\n\n::: {#bea44e08 .cell execution_count=7}\n``` {.python .cell-code}\nprint(snow_data.describe())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (9, 6)\n┌────────────┬───────────────┬────────────┬────────────────────────────┬────────────┬────────────┐\n│ statistic  ┆ station       ┆ elevation  ┆ date                       ┆ snow       ┆ water      │\n│ ---        ┆ ---           ┆ ---        ┆ ---                        ┆ ---        ┆ ---        │\n│ str        ┆ str           ┆ f64        ┆ str                        ┆ f64        ┆ f64        │\n╞════════════╪═══════════════╪════════════╪════════════════════════════╪════════════╪════════════╡\n│ count      ┆ 60265         ┆ 60265.0    ┆ 60265                      ┆ 59806.0    ┆ 59801.0    │\n│ null_count ┆ 0             ┆ 0.0        ┆ 0                          ┆ 459.0      ┆ 464.0      │\n│ mean       ┆ null          ┆ 1363.41369 ┆ 1989-10-21 01:30:49.371940 ┆ 118.480019 ┆ 428.141503 │\n│ std        ┆ null          ┆ 402.853802 ┆ null                       ┆ 94.081751  ┆ 415.776042 │\n│ min        ┆ Aberdeen Lake ┆ 0.0        ┆ 1935-03-22                 ┆ 0.0        ┆ 0.0        │\n│ 25%        ┆ null          ┆ 1100.0     ┆ 1976-04-28                 ┆ 52.0       ┆ 136.0      │\n│ 50%        ┆ null          ┆ 1400.0     ┆ 1989-01-01                 ┆ 98.0       ┆ 300.0      │\n│ 75%        ┆ null          ┆ 1660.0     ┆ 2004-02-25                 ┆ 165.0      ┆ 599.0      │\n│ max        ┆ Yellowhead    ┆ 2230.0     ┆ 2026-02-04                 ┆ 806.0      ┆ 3845.0     │\n└────────────┴───────────────┴────────────┴────────────────────────────┴────────────┴────────────┘\n```\n:::\n:::\n\n\n::: {#108300bb .cell execution_count=8}\n``` {.python .cell-code}\nn_stations = snow_data.select(\"station\").n_unique()\nprint(f\"There are {n_stations} stations.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nThere are 364 stations.\n```\n:::\n:::\n\n\n::: {#bc589573 .cell execution_count=9}\n``` {.python .cell-code}\nlist_stations = snow_data.get_column(\"station\").unique().to_list()\nprint(list_stations)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n['Diamond Head', 'Forrest Kerr Creek', 'Telegraph Creek', 'Whiterocks Mountain', 'Upper Thelwood Lake', 'Bouleau Creek', 'Kemess Creek Upper', 'Wonowon', 'Grayling River', 'Mount Albreda', 'Azure River', 'Green Mountain', 'Caverhill Lake New', 'Mica Creek', 'Lac Le Jeune Lower', 'Greyback Reservoir', 'Mount Cokely', 'Trapping Creek (Lower)', 'Tahtsa Lake', 'Kimberley', 'Mcbride Lower', 'Summit Lake', 'Tenquille Lake', 'Lu Lake', 'Powell River Lower', 'Sunbeam Lake', 'Downie Slide Lower', 'Edwards Lake', 'Trout River', 'Chapman Lake', 'Mount Abbot', 'Arrow Creek', 'Mount Cronin', 'Granite Mountain', 'Kirbyville Lake', 'Isintok Lake', 'Postill Lake Upper', 'Vermilion River No.5', 'Duncan Lake No. 2', 'Wedeene River', 'Shalalth', 'Duffey Lake', 'Canoe River', 'Bigmouth Creek', 'Middle River', 'Hedrick Lake', 'Trapping Creek', 'Kwadacha River', 'Tumeka Creek', 'Ware (Lower)', 'Tiedemann Glacier', 'Lady Laurier Lake', 'Kinbasket Lake', 'Upper Elk River', 'Ottomite', 'Bird Creek', 'Mount Assiniboine', 'Hudson Bay Mountain', 'Bluejoint Mountain', 'Haddo Lake', 'Mount Saint Anne', 'Fernie Ridge', 'Lytton', 'Alouette Lake', 'Missezula Mountain', 'Penfold Creek', 'Schaft Creek', 'Beaverfoot', 'Nickel Plate', 'Wolf River Lower', 'Pavilion Mtn.', 'Vermilion River No.2', 'Vaseux Creek', 'Ipec Lake', 'Esperon Creek Upper', 'Sproat Lake', 'Boston Bar Creek (Upper)', 'Powell River Upper', 'Mount Copeland', 'Braden River', 'Fish Lake', 'Kemess Creek Lower', 'Revolution Creek', 'Silver Star Mountain', 'Tahltan Lake', 'Morfee Mountain', 'Humamilt Lake', 'Iskut', 'Tyaughton Creek (North)', 'Tutizzi Lake', 'Jade City', 'Kinaskan Lake', 'Trapping Creek (Upper)', 'Esperon Creek Lower', 'Sullivan Mine', 'Hourglass', 'Bullhead Mountain', 'Bullmoose Creek', 'Porcupine Ridge', 'Char Creek', 'Wolf River Middle', 'Carmi', 'Powell River', 'Fish Lake No. 2', 'Pulpit Lake', 'Great Bear', 'Farron', 'Harry Lake', 'Mcgillivray Pass', 'Rabbit River', 'Gray Creek Lower', 'Revelstoke', 'Carrs Landing (Upper)', 'Tashme', 'Highland Valley', 'Esperon Creek Middle', 'Downton Lake Upper', 'Toad River', 'Vermilion River No.1', 'Pearson Creek', 'Mcqueen Lake', 'Mcleod Lake', 'Lightning Lake', 'Macdonald Lake', 'Big Creek', 'Hollyburn', 'Kaza Lake', 'Blackwall Peak', 'Sandon', 'Callaghan Creek', 'Vermilion River No. 3', 'Nostetuko River', 'Mount Sheba', 'Black Mountain', 'Smithers', 'Boss Mountain Mine', 'Trygve Lake', 'Hamilton Hill', 'Hope', 'Labour Day Lake', 'Red Chris Mine Lower', 'Downie Site 8', 'Portage Mountain', 'Fernie East', 'Thunder Creek', 'Pass Lake', 'Dog Mountain', 'Downie Slide Upper', 'Kluachesi Lake', 'Brookmere', 'Bush River', 'Blackwater Lookout', 'Meadow Mountain', 'Horsefly Mountain', 'Beatton River', 'Pondosy Lake', 'Barkerville', 'Mount Templeman', 'Missinka River', 'Atlin Lake', 'Tatlayoko Lake', 'Grouse Mountain', 'Dome Mountain', 'Prince George Airport', 'Kostal Lake', 'Boundary', 'Blue River Town', 'Pavilion', 'Stave Lake', 'Gerrard', 'Bralorne', 'Gray Creek Upper', 'Forbidden Plateau', 'Precipice', 'Mckendrick Creek', 'Fort St. John Airport', 'Philip Lake', 'Morrissey Ridge', 'Nechako', 'Mcbride Upper', 'Tachek Creek', 'Bridge Glacier Lower', 'Purcell', 'Sikanni Lake', 'Mcculloch', 'Monashee Pass', 'Bonaparte Lake', 'Wedeene River South', 'Vermont Creek', 'Whatshan Lower', 'Sukunka River', 'Trout Creek West', 'Bear Creek Reservoir', 'Nazko', 'Lyford Mountain', 'Dease Lake', 'Nahatlatch River', 'Blackwater Creek', 'Old Glory Mountain', 'Oyama Lake', 'Conant Lake', 'Puntzi Mountain', 'Burman Lake', 'New Tashme', 'Chapman Creek', 'Mackenzie Airport Manual Snow Course (2003)', 'New Glacier', 'Cornwall Hills', 'Hansard', 'Steelhead', 'Margaret Lake', 'Eaglenest Creek', 'Germansen Upper', 'Blackhawk', 'East Creek', 'Postill Lake', 'Loch Lomond', 'Mount Kobau', 'Fidelity Mountain', 'Nutli Lake', 'Orchid Lake', 'June Lake', 'Wolf River Upper', 'Palisade Lake', 'Copper Mountain', 'Dickson Lake', 'Holmes River', 'Red Chris Mine Upper', 'Equity Mine', 'Gnawed Mountain', 'Alligator Meadows', 'Mount Cook', 'Mount Wells', 'Kimberley (Middle)Vor', 'Skins Lake', 'Mcbride Middle', 'Upper Stave River', 'Upper Quinsam', 'Mount Roosevelt', 'Record Mountain', 'Fernie (Ne)', 'Lost Horse Mountain', 'Cypress Lake', 'Wade Lake', 'Tennent Lake', 'Garibaldi Lake', 'Bowron Lake', 'Burns Lake', 'Whatshan Upper', 'Mount Stearns', 'Newcastle Ridge', 'Germansen Lower', 'Mount Timothy', 'Heather Mountain', 'St. Leon Creek', 'Lost Ledge', 'Bella Coola', 'Glacier', 'Tripp Meadows', 'Yellowhead', 'Whistler Mountain', 'Anglemont', 'Longworth Upper', 'Fort St. James', 'Bugaboo Creek', 'Nelson', 'Big White Mountain', 'Mission Creek', 'Trophy Mountain', 'Burwell Lake', 'Toba River', 'Summerland Reservoir', 'Kimberley (Upper) Vor', 'Snippaker Creek', 'Link Lake', 'Coquitlam Lake', 'Triumph Creek', 'Sno-Bird Lake', 'Graystoke Lake', 'Spahomin', 'Vermilion River No.4', 'Brenda Mine', 'Terrace Airport', 'Wolverine Creek', 'Field', 'Stanley Creek', 'Shovelnose Mountain', 'Mackenzie Airport', 'Wahleach Lake', 'Fernie', 'Moyie Mountain', 'Duncan Lake', 'Klesilkwa', 'Tsaydaychi Lake', 'Koch Creek', 'Elk River', 'Fort Nelson Airport', 'Enderby', 'Carrs Landing (Lower)', 'Machmell River', 'Fredrickson Lake', 'Marble Canyon', 'Pink Mountain', 'Monkman Creek', 'Ware (Upper)', 'Granduc Mine', 'Pennask Creek', 'Bluff Creek', 'Log Cabin', 'Kicking Horse', 'Mount Joffre', 'Goldstream', 'Mount Swannell', 'Whitesail Lake', 'Sumallo River', 'Mount Revelstoke', 'Deadwood River', 'Torpy River', 'Memory Lake', 'Longworth Lower', 'Aberdeen Lake', 'Knudsen Lake', 'Harlow Creek', 'Keystone Creek', 'Cassiar', 'Islaht Lake', 'Trout Creek', 'Disappointment Lake', 'Knouff Lake', 'Ningunsaw Pass', 'Mount Seymour', 'Pacific Lake', 'Blue River', 'Narrow Lake', 'Bralorne (Upper)', 'Sunday Summit', 'Yanks Peak', 'Deadman River', 'Forfar Creek (Upper)', 'Tranquille Lake', 'Bear Pass', 'Kidprice Lake', 'Upper Stikine', 'Park Mountain', 'Boston Bar Creek (Lower)', 'Mount Penrose', 'Kimberley (Lower) Vor', 'Johanson Lake', 'Heather Mountain Upper', 'Invermere', 'Frog River', 'Barnes Creek', 'North Clemina Creek', 'Sumallo River West', 'Pine Pass', 'French Snowshoe', 'Lac Le Jeune Upper', 'Cook Forks', 'Sinclair Pass', 'Floe Lake', 'Bouleau Lake', 'Adams River', 'Watam Lake', 'Ferguson']\n```\n:::\n:::\n\n\n### Stations selection\n\nLet's select subsets of snow pillow stations located in the Southern Coastal Mountains of British Columbia. They exclude stations in the Interior (Okanagan, Kamloops, Kootenays, Cariboo, Rockies, Columbias) and Northern BC. This is where a decrease in snowpack due to global warming is the most likely to be detectable since the temperatures are not very cold and a few degrees of warming is enough to go from snow to rain.\n\n:::{.note}\n\nI used Gemini 3 to split the list of stations into mountain ranges. This was very convenient since the data doesn't include coordinates (that would have allowed to filter by latitude and longitude) nor information about the location of the stations.\n\n:::\n\nVancouver Island Ranges:\n\n::: {#2880b00f .cell execution_count=10}\n``` {.python .cell-code}\nisland_stations = [\n    \"Burman Lake\", \"Dickson Lake\", \"East Creek\", \"Forbidden Plateau\", \"Green Mountain\",\n    \"Heather Mountain\", \"Heather Mountain Upper\", \"June Lake\", \"Labour Day Lake\",\n    \"Loch Lomond\", \"Lyford Mountain\", \"Mount Cokely\", \"Mount Wells\", \"Newcastle Ridge\",\n    \"Sproat Lake\", \"Tennent Lake\", \"Upper Quinsam\", \"Upper Thelwood Lake\",\n    \"Wolf River Lower\", \"Wolf River Middle\", \"Wolf River Upper\"\n]\n```\n:::\n\n\nLower Mainland & Fraser Valley:\n\n::: {#180a6404 .cell execution_count=11}\n``` {.python .cell-code}\nvancouver_stations = [\n    \"Alouette Lake\", \"Black Mountain (Cypress Provincial Park)\", \"Burwell Lake (North Shore)\",\n    \"Coquitlam Lake\", \"Dog Mountain (Mount Seymour)\", \"Grouse Mountain\", \"Hollyburn\", \"Hope\",\n    \"Mount Saint Anne (Sunshine Coast/Sechelt)\", \"Mount Seymour\",\n    \"Orchid Lake (Stave/Lower Mainland)\", \"Palisade Lake (Capilano Watershed)\",\n    \"Stave Lake\", \"Steelhead\", \"Upper Stave River\", \"Wahleach Lake\"\n]\n```\n:::\n\n\nSea-to-Sky, Garibaldi & Bridge River:\n\n::: {#c62a4927 .cell execution_count=12}\n``` {.python .cell-code}\ns2s_stations = [\n    \"Bralorne\", \"Bralorne (Upper)\", \"Bridge Glacier Lower\", \"Callaghan Creek\", \"Diamond Head\",\n    \"Downton Lake Upper\", \"Duffey Lake\", \"Garibaldi Lake\", \"McGillivray Pass\", \"Mount Cook\",\n    \"Mount Penrose\", \"Mount Sheba\", \"Powell River\", \"Powell River Lower\", \"Powell River Upper\",\n    \"Shalalth\", \"Shovelnose Mountain\", \"Tenquille Lake\", \"Toba River\",\n    \"Tyaughton Creek (North)\", \"Whistler Mountain\"\n]\n```\n:::\n\n\nCascades & Coquihalla (Southern Border Ranges):\n\n::: {#d6717e3c .cell execution_count=13}\n``` {.python .cell-code}\ncascades_stations = [\n    \"Blackwall Peak\", \"Boston Bar Creek (Lower)\", \"Boston Bar Creek (Upper)\", \"Great Bear\",\n    \"Klesilkwa\", \"Lightning Lake\", \"Nahatlatch River\", \"New Tashme\", \"Sumallo River\",\n    \"Sumallo River West\", \"Sunday Summit\", \"Tashme\"\n]\n```\n:::\n\n\n::: {#4521acb7 .cell execution_count=14}\n``` {.python .cell-code}\nselected_data = snow_data.filter(\n    pl.col(\"station\").is_in(\n        island_stations + vancouver_stations + s2s_stations + cascades_stations\n    )\n).with_columns(\n    pl.when(pl.col(\"station\").is_in(island_stations)).then(pl.lit(\"Vancouver Island\"))\n    .when(pl.col(\"station\").is_in(vancouver_stations)).then(pl.lit(\"Lower Mainland\"))\n    .when(pl.col(\"station\").is_in(s2s_stations)).then(pl.lit(\"Sea to Sky\"))\n    .otherwise(pl.lit(\"Cascades\"))\n    .alias(\"range\")\n)\n```\n:::\n\n\n### Convert to seasons\n\nSnow pillow data go from October ^1st^ of one year to September ^30th^ of the following year. Let's bin the data into snow seasons:\n\n::: {#5ed63841 .cell execution_count=15}\n``` {.python .cell-code}\nseason_data = selected_data.with_columns(\n\tpl.col(\"date\").dt.offset_by(\"3mo\").dt.year().alias(\"season\")\n)\n\nprint(season_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (8_867, 7)\n┌─────────────┬───────────┬────────────┬───────┬───────┬──────────────────┬────────┐\n│ station     ┆ elevation ┆ date       ┆ snow  ┆ water ┆ range            ┆ season │\n│ ---         ┆ ---       ┆ ---        ┆ ---   ┆ ---   ┆ ---              ┆ ---    │\n│ str         ┆ i64       ┆ date       ┆ f64   ┆ f64   ┆ str              ┆ i32    │\n╞═════════════╪═══════════╪════════════╪═══════╪═══════╪══════════════════╪════════╡\n│ Mount Wells ┆ 1490      ┆ 1952-02-29 ┆ 127.0 ┆ 358.0 ┆ Vancouver Island ┆ 1952   │\n│ Mount Wells ┆ 1490      ┆ 1953-02-26 ┆ 127.0 ┆ 371.0 ┆ Vancouver Island ┆ 1953   │\n│ Mount Wells ┆ 1490      ┆ 1953-04-02 ┆ 117.0 ┆ 376.0 ┆ Vancouver Island ┆ 1953   │\n│ Mount Wells ┆ 1490      ┆ 1953-05-06 ┆ 122.0 ┆ 411.0 ┆ Vancouver Island ┆ 1953   │\n│ Mount Wells ┆ 1490      ┆ 1954-03-02 ┆ 185.0 ┆ 577.0 ┆ Vancouver Island ┆ 1954   │\n│ …           ┆ …         ┆ …          ┆ …     ┆ …     ┆ …                ┆ …      │\n│ Mount Sheba ┆ 1490      ┆ 2022-12-30 ┆ 112.0 ┆ 301.0 ┆ Sea to Sky       ┆ 2023   │\n│ Mount Sheba ┆ 1490      ┆ 2023-02-01 ┆ null  ┆ null  ┆ Sea to Sky       ┆ 2023   │\n│ Mount Sheba ┆ 1490      ┆ 2023-02-28 ┆ 225.0 ┆ 715.0 ┆ Sea to Sky       ┆ 2023   │\n│ Mount Sheba ┆ 1490      ┆ 2023-03-30 ┆ 206.0 ┆ 794.0 ┆ Sea to Sky       ┆ 2023   │\n│ Mount Sheba ┆ 1490      ┆ 2023-04-28 ┆ 208.0 ┆ 853.0 ┆ Sea to Sky       ┆ 2023   │\n└─────────────┴───────────┴────────────┴───────┴───────┴──────────────────┴────────┘\n```\n:::\n:::\n\n\n### Select balanced panel\n\n[`polars.DataFrame.pivot`](https://docs.pola.rs/api/python/stable/reference/dataframe/api/polars.DataFrame.pivot.html) turns a long-format DataFrame to a wide-format one.\n\n::: {#3b2e7f94 .cell execution_count=16}\n``` {.python .cell-code}\nstations_years = season_data.pivot(\n    \"season\",\n    index=\"station\",\n    values=\"snow\",\n    sort_columns=True,\n    aggregate_function=\"mean\"\n)\n\nprint(stations_years)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (63, 93)\n┌────────────────────┬──────┬──────┬──────┬───┬───────────┬───────────┬───────────┬───────┐\n│ station            ┆ 1935 ┆ 1936 ┆ 1937 ┆ … ┆ 2023      ┆ 2024      ┆ 2025      ┆ 2026  │\n│ ---                ┆ ---  ┆ ---  ┆ ---  ┆   ┆ ---       ┆ ---       ┆ ---       ┆ ---   │\n│ str                ┆ f64  ┆ f64  ┆ f64  ┆   ┆ f64       ┆ f64       ┆ f64       ┆ f64   │\n╞════════════════════╪══════╪══════╪══════╪═══╪═══════════╪═══════════╪═══════════╪═══════╡\n│ Mount Wells        ┆ null ┆ null ┆ null ┆ … ┆ 107.0     ┆ 84.0      ┆ 78.8      ┆ 123.0 │\n│ Mount Penrose      ┆ null ┆ null ┆ null ┆ … ┆ null      ┆ null      ┆ null      ┆ null  │\n│ Green Mountain     ┆ null ┆ null ┆ null ┆ … ┆ null      ┆ null      ┆ null      ┆ null  │\n│ Bralorne           ┆ null ┆ null ┆ null ┆ … ┆ 45.0      ┆ 34.0      ┆ null      ┆ null  │\n│ Shalalth           ┆ null ┆ null ┆ null ┆ … ┆ null      ┆ null      ┆ null      ┆ null  │\n│ …                  ┆ …    ┆ …    ┆ …    ┆ … ┆ …         ┆ …         ┆ …         ┆ …     │\n│ Sumallo River      ┆ null ┆ null ┆ null ┆ … ┆ null      ┆ null      ┆ null      ┆ null  │\n│ Sumallo River West ┆ null ┆ null ┆ null ┆ … ┆ 30.25     ┆ 4.25      ┆ 0.0       ┆ 28.0  │\n│ Lightning Lake     ┆ null ┆ null ┆ null ┆ … ┆ 71.333333 ┆ 51.666667 ┆ 33.333333 ┆ null  │\n│ Klesilkwa          ┆ null ┆ null ┆ null ┆ … ┆ 31.0      ┆ 5.6       ┆ 9.2       ┆ 35.0  │\n│ Mount Sheba        ┆ null ┆ null ┆ null ┆ … ┆ 187.75    ┆ null      ┆ null      ┆ null  │\n└────────────────────┴──────┴──────┴──────┴───┴───────────┴───────────┴───────────┴───────┘\n```\n:::\n:::\n\n\nThis clearly shows that the data was not collected on all the stations for all years. If we want to see trends over time, this is not good, particularly since not all stations are at the same elevation (if early years mostly had low elevations stations and recent years have more stations in the alpine, this would give a strong fake signal).\n\nWe need to select a period and a set of stations that are monitored throughout that period. This is called a balanced panel.\n\n::: {#1f8eac5f .cell execution_count=17}\n``` {.python .cell-code}\ndef n_valid_in_period(df, period_start, period_end):\n    test_seasons = range(period_start, period_end + 1)\n\n    # Filter data for the test seasons\n    test_seasons_subset = df.filter(pl.col(\"season\").is_in(test_seasons))\n\n    # Count seasons per station\n    station_counts = test_seasons_subset.group_by(\"station\").agg(\n        pl.col(\"season\").n_unique().alias(\"n_seasons\")\n    )\n\n    # Filter stations with data for all test seasons\n    valid_stations = station_counts.filter(pl.col(\"n_seasons\") == len(test_seasons))\n\n    n_valid = len(valid_stations)\n\n    return (n_valid, period_start, period_end)\n```\n:::\n\n\n::: {#12d0e016 .cell execution_count=18}\n``` {.python .cell-code}\nyears = season_data.select(pl.col(\"date\").dt.year())\nmin_year = years.min().item()\nmax_year = years.max().item()\nprint(f\"Year range: {min_year} to {max_year}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nYear range: 1935 to 2026\n```\n:::\n:::\n\n\n::: {#464ad9aa .cell execution_count=19}\n``` {.python .cell-code}\nlist_n_valid = []\n\nfor i in range(min_year, max_year + 1):\n    for j in range(min_year, max_year + 1):\n        if j - i > 9:         # we want a period of at least 10 years\n            list_n_valid.append(n_valid_in_period(season_data, i, j))\n```\n:::\n\n\nWe want at least 5 stations, so let's clean the list from all `n_valid < 5`:\n\n::: {#99375817 .cell execution_count=20}\n``` {.python .cell-code}\nnon_nil_list_n_valid = [i for i in list_n_valid if i[0] >= 5]\n```\n:::\n\n\n::: {#ade1b256 .cell execution_count=21}\n``` {.python .cell-code}\nbalanced_panels = pl.DataFrame(\n    non_nil_list_n_valid,\n    orient=\"row\",\n    schema=[\"n_valid\", \"period_start\", \"period_end\"]\n).with_columns(\n    (pl.col(\"period_end\") - pl.col(\"period_start\")).alias(\"period_length\")\n).sort(\n    \"period_length\", \"n_valid\", descending=True\n)\n```\n:::\n\n\n::: {#b0903f19 .cell execution_count=22}\n``` {.python .cell-code}\nprint(balanced_panels)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (2_211, 4)\n┌─────────┬──────────────┬────────────┬───────────────┐\n│ n_valid ┆ period_start ┆ period_end ┆ period_length │\n│ ---     ┆ ---          ┆ ---        ┆ ---           │\n│ i64     ┆ i64          ┆ i64        ┆ i64           │\n╞═════════╪══════════════╪════════════╪═══════════════╡\n│ 5       ┆ 1954         ┆ 2025       ┆ 71            │\n│ 5       ┆ 1954         ┆ 2024       ┆ 70            │\n│ 5       ┆ 1955         ┆ 2025       ┆ 70            │\n│ 5       ┆ 1954         ┆ 2023       ┆ 69            │\n│ 5       ┆ 1955         ┆ 2024       ┆ 69            │\n│ …       ┆ …            ┆ …          ┆ …             │\n│ 6       ┆ 1950         ┆ 1960       ┆ 10            │\n│ 6       ┆ 1951         ┆ 1961       ┆ 10            │\n│ 5       ┆ 1948         ┆ 1958       ┆ 10            │\n│ 5       ┆ 1947         ┆ 1957       ┆ 10            │\n│ 5       ┆ 1949         ┆ 1959       ┆ 10            │\n└─────────┴──────────────┴────────────┴───────────────┘\n```\n:::\n:::\n\n\n:::{.exo}\n\n:::{.yourturn}\n\nYour turn:\n\n:::\n\nCreate a DataFrame of balanced panels similar to `balanced_panels` but in which all periods include the present.\n\nCall it `current`.\n\n\n\n:::\n\nTo print more rows than the default, you can use [`polars.Config.set_tbl_rows`](https://docs.pola.rs/api/python/dev/reference/api/polars.Config.set_tbl_rows.html):\n\n::: {#d11ea0f8 .cell execution_count=24}\n``` {.python .cell-code}\nwith pl.Config(tbl_rows=100):\n    print(balanced_current)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (59, 4)\n┌─────────┬──────────────┬────────────┬───────────────┐\n│ n_valid ┆ period_start ┆ period_end ┆ period_length │\n│ ---     ┆ ---          ┆ ---        ┆ ---           │\n│ i64     ┆ i64          ┆ i64        ┆ i64           │\n╞═════════╪══════════════╪════════════╪═══════════════╡\n│ 5       ┆ 1958         ┆ 2026       ┆ 68            │\n│ 5       ┆ 1959         ┆ 2026       ┆ 67            │\n│ 5       ┆ 1960         ┆ 2026       ┆ 66            │\n│ 5       ┆ 1961         ┆ 2026       ┆ 65            │\n│ 5       ┆ 1962         ┆ 2026       ┆ 64            │\n│ 5       ┆ 1963         ┆ 2026       ┆ 63            │\n│ 5       ┆ 1964         ┆ 2026       ┆ 62            │\n│ 5       ┆ 1965         ┆ 2026       ┆ 61            │\n│ 5       ┆ 1966         ┆ 2026       ┆ 60            │\n│ 5       ┆ 1967         ┆ 2026       ┆ 59            │\n│ 6       ┆ 1968         ┆ 2026       ┆ 58            │\n│ 6       ┆ 1969         ┆ 2026       ┆ 57            │\n│ 7       ┆ 1970         ┆ 2026       ┆ 56            │\n│ 7       ┆ 1971         ┆ 2026       ┆ 55            │\n│ 7       ┆ 1972         ┆ 2026       ┆ 54            │\n│ 7       ┆ 1973         ┆ 2026       ┆ 53            │\n│ 7       ┆ 1974         ┆ 2026       ┆ 52            │\n│ 7       ┆ 1975         ┆ 2026       ┆ 51            │\n│ 7       ┆ 1976         ┆ 2026       ┆ 50            │\n│ 7       ┆ 1977         ┆ 2026       ┆ 49            │\n│ 8       ┆ 1978         ┆ 2026       ┆ 48            │\n│ 8       ┆ 1979         ┆ 2026       ┆ 47            │\n│ 8       ┆ 1980         ┆ 2026       ┆ 46            │\n│ 8       ┆ 1981         ┆ 2026       ┆ 45            │\n│ 8       ┆ 1982         ┆ 2026       ┆ 44            │\n│ 8       ┆ 1983         ┆ 2026       ┆ 43            │\n│ 8       ┆ 1984         ┆ 2026       ┆ 42            │\n│ 8       ┆ 1985         ┆ 2026       ┆ 41            │\n│ 8       ┆ 1986         ┆ 2026       ┆ 40            │\n│ 8       ┆ 1987         ┆ 2026       ┆ 39            │\n│ 8       ┆ 1988         ┆ 2026       ┆ 38            │\n│ 8       ┆ 1989         ┆ 2026       ┆ 37            │\n│ 8       ┆ 1990         ┆ 2026       ┆ 36            │\n│ 9       ┆ 1991         ┆ 2026       ┆ 35            │\n│ 10      ┆ 1992         ┆ 2026       ┆ 34            │\n│ 10      ┆ 1993         ┆ 2026       ┆ 33            │\n│ 10      ┆ 1994         ┆ 2026       ┆ 32            │\n│ 10      ┆ 1995         ┆ 2026       ┆ 31            │\n│ 10      ┆ 1996         ┆ 2026       ┆ 30            │\n│ 10      ┆ 1997         ┆ 2026       ┆ 29            │\n│ 10      ┆ 1998         ┆ 2026       ┆ 28            │\n│ 10      ┆ 1999         ┆ 2026       ┆ 27            │\n│ 10      ┆ 2000         ┆ 2026       ┆ 26            │\n│ 10      ┆ 2001         ┆ 2026       ┆ 25            │\n│ 10      ┆ 2002         ┆ 2026       ┆ 24            │\n│ 10      ┆ 2003         ┆ 2026       ┆ 23            │\n│ 10      ┆ 2004         ┆ 2026       ┆ 22            │\n│ 10      ┆ 2005         ┆ 2026       ┆ 21            │\n│ 10      ┆ 2006         ┆ 2026       ┆ 20            │\n│ 10      ┆ 2007         ┆ 2026       ┆ 19            │\n│ 10      ┆ 2008         ┆ 2026       ┆ 18            │\n│ 10      ┆ 2009         ┆ 2026       ┆ 17            │\n│ 10      ┆ 2010         ┆ 2026       ┆ 16            │\n│ 10      ┆ 2011         ┆ 2026       ┆ 15            │\n│ 10      ┆ 2012         ┆ 2026       ┆ 14            │\n│ 10      ┆ 2013         ┆ 2026       ┆ 13            │\n│ 10      ┆ 2014         ┆ 2026       ┆ 12            │\n│ 10      ┆ 2015         ┆ 2026       ┆ 11            │\n│ 10      ┆ 2016         ┆ 2026       ┆ 10            │\n└─────────┴──────────────┴────────────┴───────────────┘\n```\n:::\n:::\n\n\n48 seasons for 8 stations is not bad, so let's select the period from 1978 to the present.\n\n::: {#e2909d20 .cell execution_count=25}\n``` {.python .cell-code}\nsubset_df = season_data.filter(\n    pl.col(\"season\").is_between(1978, 2026)\n)\n\nprint(subset_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (6_261, 7)\n┌─────────────┬───────────┬────────────┬───────┬───────┬──────────────────┬────────┐\n│ station     ┆ elevation ┆ date       ┆ snow  ┆ water ┆ range            ┆ season │\n│ ---         ┆ ---       ┆ ---        ┆ ---   ┆ ---   ┆ ---              ┆ ---    │\n│ str         ┆ i64       ┆ date       ┆ f64   ┆ f64   ┆ str              ┆ i32    │\n╞═════════════╪═══════════╪════════════╪═══════╪═══════╪══════════════════╪════════╡\n│ Mount Wells ┆ 1490      ┆ 1978-02-27 ┆ 112.0 ┆ 310.0 ┆ Vancouver Island ┆ 1978   │\n│ Mount Wells ┆ 1490      ┆ 1978-03-28 ┆ 127.0 ┆ 358.0 ┆ Vancouver Island ┆ 1978   │\n│ Mount Wells ┆ 1490      ┆ 1978-04-26 ┆ 124.0 ┆ 404.0 ┆ Vancouver Island ┆ 1978   │\n│ Mount Wells ┆ 1490      ┆ 1978-05-31 ┆ 56.0  ┆ 198.0 ┆ Vancouver Island ┆ 1978   │\n│ Mount Wells ┆ 1490      ┆ 1979-02-26 ┆ 160.0 ┆ 495.0 ┆ Vancouver Island ┆ 1979   │\n│ …           ┆ …         ┆ …          ┆ …     ┆ …     ┆ …                ┆ …      │\n│ Mount Sheba ┆ 1490      ┆ 2022-12-30 ┆ 112.0 ┆ 301.0 ┆ Sea to Sky       ┆ 2023   │\n│ Mount Sheba ┆ 1490      ┆ 2023-02-01 ┆ null  ┆ null  ┆ Sea to Sky       ┆ 2023   │\n│ Mount Sheba ┆ 1490      ┆ 2023-02-28 ┆ 225.0 ┆ 715.0 ┆ Sea to Sky       ┆ 2023   │\n│ Mount Sheba ┆ 1490      ┆ 2023-03-30 ┆ 206.0 ┆ 794.0 ┆ Sea to Sky       ┆ 2023   │\n│ Mount Sheba ┆ 1490      ┆ 2023-04-28 ┆ 208.0 ┆ 853.0 ┆ Sea to Sky       ┆ 2023   │\n└─────────────┴───────────┴────────────┴───────┴───────┴──────────────────┴────────┘\n```\n:::\n:::\n\n\n::: {#836553f2 .cell execution_count=26}\n``` {.python .cell-code}\nmax_n_seasons = subset_df.group_by(\"station\").agg(\n    pl.col(\"season\").n_unique().alias(\"n_seasons\")\n).select(\"n_seasons\").max().item()\n\nsubset_stations = subset_df.group_by(\"station\").agg(\n    pl.col(\"season\").n_unique().alias(\"n_seasons\")\n).filter(pl.col(\"n_seasons\") == max_n_seasons).get_column(\"station\").to_list()\n\nprint(subset_stations)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n['Nahatlatch River', 'Wolf River Lower', 'Forbidden Plateau', 'Mount Wells', 'Duffey Lake', 'Grouse Mountain', 'Upper Thelwood Lake', 'Klesilkwa']\n```\n:::\n:::\n\n\n::: {#ffd50609 .cell execution_count=27}\n``` {.python .cell-code}\nsubset_data = subset_df.filter(pl.col(\"station\").is_in(subset_stations))\n\nprint(subset_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (1_675, 7)\n┌─────────────┬───────────┬────────────┬───────┬───────┬──────────────────┬────────┐\n│ station     ┆ elevation ┆ date       ┆ snow  ┆ water ┆ range            ┆ season │\n│ ---         ┆ ---       ┆ ---        ┆ ---   ┆ ---   ┆ ---              ┆ ---    │\n│ str         ┆ i64       ┆ date       ┆ f64   ┆ f64   ┆ str              ┆ i32    │\n╞═════════════╪═══════════╪════════════╪═══════╪═══════╪══════════════════╪════════╡\n│ Mount Wells ┆ 1490      ┆ 1978-02-27 ┆ 112.0 ┆ 310.0 ┆ Vancouver Island ┆ 1978   │\n│ Mount Wells ┆ 1490      ┆ 1978-03-28 ┆ 127.0 ┆ 358.0 ┆ Vancouver Island ┆ 1978   │\n│ Mount Wells ┆ 1490      ┆ 1978-04-26 ┆ 124.0 ┆ 404.0 ┆ Vancouver Island ┆ 1978   │\n│ Mount Wells ┆ 1490      ┆ 1978-05-31 ┆ 56.0  ┆ 198.0 ┆ Vancouver Island ┆ 1978   │\n│ Mount Wells ┆ 1490      ┆ 1979-02-26 ┆ 160.0 ┆ 495.0 ┆ Vancouver Island ┆ 1979   │\n│ …           ┆ …         ┆ …          ┆ …     ┆ …     ┆ …                ┆ …      │\n│ Klesilkwa   ┆ 1175      ┆ 2025-02-26 ┆ 14.0  ┆ 50.0  ┆ Cascades         ┆ 2025   │\n│ Klesilkwa   ┆ 1175      ┆ 2025-03-30 ┆ 5.0   ┆ 18.0  ┆ Cascades         ┆ 2025   │\n│ Klesilkwa   ┆ 1175      ┆ 2025-04-29 ┆ 0.0   ┆ 0.0   ┆ Cascades         ┆ 2025   │\n│ Klesilkwa   ┆ 1175      ┆ 2025-12-31 ┆ 48.0  ┆ 106.0 ┆ Cascades         ┆ 2026   │\n│ Klesilkwa   ┆ 1175      ┆ 2026-01-27 ┆ 22.0  ┆ 71.0  ┆ Cascades         ┆ 2026   │\n└─────────────┴───────────┴────────────┴───────┴───────┴──────────────────┴────────┘\n```\n:::\n:::\n\n\n### ADD ENSO data\n\n[El Niño–Southern Oscillation (ENSO)](https://en.wikipedia.org/wiki/El_Ni%C3%B1o%E2%80%93Southern_Oscillation) \n\nBased on NOAA ONI data. Year listed is the \"Season Year\" (approx Jan-Apr of that year). e.g. El Niño 1997-98 -> Season 1998\n\n<!-- ```{python} -->\n<!-- # all events -->\n\n<!-- el_nino_years = [ -->\n<!-- \t1940, 1941, 1942, 1947, 1952, 1954, 1958, 1959, 1964, 1966, 1969, 1970, 1973, 1977, 1978, -->\n<!-- \t1980, 1983, 1987, 1988, 1992, 1995, 1998, 2003, 2005, 2007, 2010, 2015, 2016, 2019, 2020, 2024 -->\n<!-- ] -->\n\n<!-- la_nina_years = [ -->\n<!-- \t1939, 1943, 1945, 1946, 1950, 1951, 1955, 1956, 1957, 1962, 1965, 1968, 1971, 1972, 1974, 1975, 1976, 1984, -->\n<!-- \t1985, 1989, 1996, 1999, 2000, 2001, 2006, 2008, 2009, 2011, 2012, 2017, 2018, 2021, 2022, 2023, 2025, 2026 -->\n<!-- ] -->\n<!-- ``` -->\n\n<!-- all events, selected period only: -->\n\n::: {#75c6d53d .cell execution_count=28}\n``` {.python .cell-code}\nel_nino_years = [\n\t1978, 1980, 1983, 1987, 1988, 1992, 1995, 1998, 2003,\n    2005, 2007, 2010, 2015, 2016, 2019, 2020, 2024\n]\n\nla_nina_years = [\n\t1984, 1985, 1989, 1996, 1999, 2000, 2001, 2006, 2008, 2009,\n    2011, 2012, 2017, 2018, 2021, 2022, 2023, 2025, 2026\n]\n```\n:::\n\n\n<!-- ```{python} -->\n<!-- # strong events -->\n\n<!-- el_nino_years = [ -->\n<!-- \t1941, 1942, 1958, 1966, 1973, 1978, 1980, 1983, 1987, -->\n<!-- \t1988, 1992, 1995, 1998, 2003, 2007, 2010, 2016, 2024 -->\n<!-- ] -->\n\n<!-- la_nina_years = [ -->\n<!-- \t1939, 1943, 1950, 1951, 1955, 1956, 1962, 1971, 1974, -->\n<!-- \t1976, 1989, 1999, 2000, 2008, 2011, 2012, 2021, 2022 -->\n<!-- ] -->\n<!-- ``` -->\n\n<!-- ```{python} -->\n<!-- # strong events, selected period only -->\n\n<!-- el_nino_years = [ -->\n<!-- \t1978, 1980, 1983, 1987,\t1988, 1992, 1995, 1998, 2003, 2007, 2010, 2016, 2024 -->\n<!-- ] -->\n\n<!-- la_nina_years = [ -->\n<!-- \t1989, 1999, 2000, 2008, 2011, 2012, 2021, 2022 -->\n<!-- ] -->\n<!-- ``` -->\n\n::: {#11c786fc .cell execution_count=29}\n``` {.python .cell-code}\nsubset_enso = subset_data.with_columns(\n\tpl.when(pl.col(\"season\").is_in(el_nino_years)).then(pl.lit(\"El Niño\"))\n\t.when(pl.col(\"season\").is_in(la_nina_years)).then(pl.lit(\"La Niña\"))\n\t.otherwise(pl.lit(\"Neutral\"))\n\t.alias(\"enso\")\n)\n\nprint(subset_enso)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nshape: (1_675, 8)\n┌─────────────┬───────────┬────────────┬───────┬───────┬──────────────────┬────────┬─────────┐\n│ station     ┆ elevation ┆ date       ┆ snow  ┆ water ┆ range            ┆ season ┆ enso    │\n│ ---         ┆ ---       ┆ ---        ┆ ---   ┆ ---   ┆ ---              ┆ ---    ┆ ---     │\n│ str         ┆ i64       ┆ date       ┆ f64   ┆ f64   ┆ str              ┆ i32    ┆ str     │\n╞═════════════╪═══════════╪════════════╪═══════╪═══════╪══════════════════╪════════╪═════════╡\n│ Mount Wells ┆ 1490      ┆ 1978-02-27 ┆ 112.0 ┆ 310.0 ┆ Vancouver Island ┆ 1978   ┆ El Niño │\n│ Mount Wells ┆ 1490      ┆ 1978-03-28 ┆ 127.0 ┆ 358.0 ┆ Vancouver Island ┆ 1978   ┆ El Niño │\n│ Mount Wells ┆ 1490      ┆ 1978-04-26 ┆ 124.0 ┆ 404.0 ┆ Vancouver Island ┆ 1978   ┆ El Niño │\n│ Mount Wells ┆ 1490      ┆ 1978-05-31 ┆ 56.0  ┆ 198.0 ┆ Vancouver Island ┆ 1978   ┆ El Niño │\n│ Mount Wells ┆ 1490      ┆ 1979-02-26 ┆ 160.0 ┆ 495.0 ┆ Vancouver Island ┆ 1979   ┆ Neutral │\n│ …           ┆ …         ┆ …          ┆ …     ┆ …     ┆ …                ┆ …      ┆ …       │\n│ Klesilkwa   ┆ 1175      ┆ 2025-02-26 ┆ 14.0  ┆ 50.0  ┆ Cascades         ┆ 2025   ┆ La Niña │\n│ Klesilkwa   ┆ 1175      ┆ 2025-03-30 ┆ 5.0   ┆ 18.0  ┆ Cascades         ┆ 2025   ┆ La Niña │\n│ Klesilkwa   ┆ 1175      ┆ 2025-04-29 ┆ 0.0   ┆ 0.0   ┆ Cascades         ┆ 2025   ┆ La Niña │\n│ Klesilkwa   ┆ 1175      ┆ 2025-12-31 ┆ 48.0  ┆ 106.0 ┆ Cascades         ┆ 2026   ┆ La Niña │\n│ Klesilkwa   ┆ 1175      ┆ 2026-01-27 ┆ 22.0  ┆ 71.0  ┆ Cascades         ┆ 2026   ┆ La Niña │\n└─────────────┴───────────┴────────────┴───────┴───────┴──────────────────┴────────┴─────────┘\n```\n:::\n:::\n\n\n## Plotting\n\nLet's load the seaborn library:\n\n::: {#06d446db .cell execution_count=30}\n``` {.python .cell-code}\nimport seaborn as sns\n```\n:::\n\n\n### Relation plots\n\nYou could xxx\n\n::: {#757e7e82 .cell execution_count=31}\n``` {.python .cell-code}\nseason_means = subset_enso.group_by(\n\tpl.col(\"season\"),\n\tmaintain_order=True\n).agg(\n\tpl.col(\"snow\").mean().alias(\"mean_snow\")\n)\n```\n:::\n\n\n::: {#e8f7da84 .cell execution_count=32}\n``` {.python .cell-code}\nsns.relplot(\n\tdata=season_means,\n\tkind=\"line\",\n\tx=\"season\",\n\ty=\"mean_snow\"\n).figure.set_size_inches(9, 4)\n```\n\n::: {.cell-output .cell-output-display}\n![](intro_seaborn_files/figure-html/cell-33-output-1.png){width=789 height=388}\n:::\n:::\n\n\nBut it isn't necessary with seaborn which is a statistically oriented plotting framework:\n\n::: {#9b2d384a .cell execution_count=33}\n``` {.python .cell-code}\nsns.relplot(\n\tdata=subset_enso,\n\tkind=\"line\",\n\tx=\"season\",\n\ty=\"snow\"\n).figure.set_size_inches(9, 4)\n```\n\n::: {.cell-output .cell-output-display}\n![](intro_seaborn_files/figure-html/cell-34-output-1.png){width=788 height=388}\n:::\n:::\n\n\n### Regression plots\n\n`regplot`\n\n::: {#adda9da0 .cell execution_count=34}\n``` {.python .cell-code}\nsns.regplot(\n\tdata=subset_enso,\n\tx=\"season\",\n\ty=\"snow\"\n).figure.set_size_inches(9, 4)\n```\n\n::: {.cell-output .cell-output-display}\n![](intro_seaborn_files/figure-html/cell-35-output-1.png){width=724 height=337}\n:::\n:::\n\n\n`lmplot`\n\n::: {#cbd20329 .cell execution_count=35}\n``` {.python .cell-code}\nsns.lmplot(\n\tdata=subset_enso,\n\tx=\"season\",\n\ty=\"snow\",\n    hue=\"enso\"\n).figure.set_size_inches(9, 4)\n```\n\n::: {.cell-output .cell-output-display}\n![](intro_seaborn_files/figure-html/cell-36-output-1.png){width=808 height=388}\n:::\n:::\n\n\n::: {#9dfb2f46 .cell execution_count=36}\n``` {.python .cell-code}\nel_nino_seasons = subset_enso.filter(\n    pl.col(\"enso\") == \"El Niño\"\n)\n```\n:::\n\n\n::: {#1c00e13f .cell execution_count=37}\n``` {.python .cell-code}\nsns.relplot(\n\tdata=el_nino_seasons,\n\tkind=\"line\",\n\tx=\"season\",\n\ty=\"snow\"\n).figure.set_size_inches(9, 4)\n```\n\n::: {.cell-output .cell-output-display}\n![](intro_seaborn_files/figure-html/cell-38-output-1.png){width=789 height=389}\n:::\n:::\n\n\n::: {#e06dc995 .cell execution_count=38}\n``` {.python .cell-code}\nsns.regplot(\n\tdata=el_nino_seasons,\n\tx=\"season\",\n\ty=\"snow\"\n).figure.set_size_inches(9, 4)\n```\n\n::: {.cell-output .cell-output-display}\n![](intro_seaborn_files/figure-html/cell-39-output-1.png){width=724 height=337}\n:::\n:::\n\n\n:::{.exo}\n\n:::{.yourturn}\n\nYour turn:\n\n:::\n\nMake the same plot with only the stations below 1100m to see whether climate change is affecting low elevations more strongly.\n\n\n\n\n\n<!-- ```{python} -->\n<!-- sns.regplot( -->\n<!-- \tdata=low_stations, -->\n<!-- \tx=\"season\", -->\n<!-- \ty=\"snow\" -->\n<!-- ).figure.set_size_inches(9, 4) -->\n<!-- ``` -->\n\n:::\n\n### Boxplots\n\n::: {#9e5b5850 .cell execution_count=41}\n``` {.python .cell-code}\nsns.boxplot(\n\tdata=subset_enso,\n\tx=\"enso\",\n\ty=\"snow\",\n\torder=[\"La Niña\", \"Neutral\", \"El Niño\"]\n).figure.set_size_inches(9, 9)\n```\n\n::: {.cell-output .cell-output-display}\n![](intro_seaborn_files/figure-html/cell-42-output-1.png){width=742 height=725}\n:::\n:::\n\n\n",
    "supporting": [
      "intro_seaborn_files"
    ],
    "filters": [],
    "includes": {}
  }
}